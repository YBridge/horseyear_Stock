<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºå‰ç» - å®è§‚å¾®è§‚åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e4e6eb;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #888;
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .nav-btn:hover, .nav-btn.active {
            color: #00d4ff;
            background: rgba(0,212,255,0.1);
            border-color: rgba(0,212,255,0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .analysis-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 18px;
            color: #00d4ff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .factor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .factor-card {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 15px;
        }

        .factor-card .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .factor-card .value {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
        }

        .factor-card .impact {
            font-size: 11px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .impact.positive {
            background: rgba(0,200,83,0.2);
            color: #00c853;
        }

        .impact.negative {
            background: rgba(255,82,82,0.2);
            color: #ff5252;
        }

        .impact.neutral {
            background: rgba(255,255,255,0.1);
            color: #888;
        }

        .prediction-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .prediction-card {
            background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(123,58,237,0.1));
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }

        .prediction-card .timeframe {
            font-size: 14px;
            color: #888;
            margin-bottom: 15px;
        }

        .prediction-card .trend {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-card .trend.up {
            color: #00c853;
        }

        .prediction-card .trend.down {
            color: #ff5252;
        }

        .prediction-card .trend.neutral {
            color: #888;
        }

        .prediction-card .confidence {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 15px;
        }

        .prediction-card .factors {
            font-size: 12px;
            color: #888;
            text-align: left;
        }

        .rational-emotional-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .split-card {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 20px;
        }

        .split-card .header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .split-card .header .icon {
            font-size: 24px;
        }

        .split-card .header .title {
            font-size: 16px;
            font-weight: bold;
        }

        .split-card .score {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .split-card .score .label {
            color: #888;
            font-size: 13px;
        }

        .split-card .score .value {
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #888;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .prediction-section {
                grid-template-columns: 1fr;
            }
            .rational-emotional-split {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒ å¸‚åœºå‰ç»åˆ†æ</h1>
        <p>å®è§‚å¾®è§‚ Â· ç†æ€§æƒ…ç»ª Â· è¶‹åŠ¿é¢„æµ‹</p>
    </div>

    <div class="nav-bar">
        <a href="/" class="nav-btn">ğŸ“Š è‚¡ç¥¨åˆ†æ</a>
        <a href="/watchlist" class="nav-btn">ğŸ¯ å…³æ³¨å¯¹æ¯”</a>
        <a href="/strategies" class="nav-btn">ğŸ“ ç­–ç•¥å†å²</a>
        <a href="/ai_stocks" class="nav-btn">ğŸ¤– AIæŠ•èµ„</a>
        <a href="/market_outlook" class="nav-btn active">ğŸŒ å¸‚åœºå‰ç»</a>
    </div>

    <div class="container" id="mainContent">
        <div class="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åˆ†æå¸‚åœºç¯å¢ƒ...</p>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        async function loadMarketOutlook() {
            const container = document.getElementById('mainContent');

            try {
                const response = await fetch('/api/market_outlook');
                const data = await response.json();

                if (data.success) {
                    renderMarketOutlook(data);
                } else {
                    container.innerHTML = `
                        <div class="loading">
                            <p style="color: #ff6b6b;">åˆ†æå¤±è´¥: ${data.error}</p>
                            <button onclick="loadMarketOutlook()" style="margin-top:20px;padding:10px 20px;background:#00d4ff;border:none;border-radius:10px;cursor:pointer;">é‡è¯•</button>
                        </div>
                    `;
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="loading">
                        <p style="color: #ff6b6b;">ç½‘ç»œé”™è¯¯: ${error.message}</p>
                        <button onclick="loadMarketOutlook()" style="margin-top:20px;padding:10px 20px;background:#00d4ff;border:none;border-radius:10px;cursor:pointer;">é‡è¯•</button>
                    </div>
                `;
            }
        }

        function renderMarketOutlook(data) {
            const outlook = data.outlook;
            const container = document.getElementById('mainContent');

            container.innerHTML = `
                <!-- å®è§‚ç¯å¢ƒåˆ†æ -->
                <div class="analysis-section">
                    <div class="section-title">
                        ğŸ›ï¸ å®è§‚ç»æµç¯å¢ƒ
                    </div>
                    <div class="factor-grid">
                        ${renderMacroFactors(outlook.macro)}
                    </div>
                </div>

                <!-- å¸‚åœºæƒ…ç»ªåˆ†æ -->
                <div class="analysis-section">
                    <div class="section-title">
                        ğŸ’­ å¸‚åœºæƒ…ç»ªæŒ‡æ ‡
                    </div>
                    <div class="factor-grid">
                        ${renderSentimentFactors(outlook.sentiment)}
                    </div>
                </div>

                <!-- ç†æ€§æƒ…ç»ªåˆ†æ‹† -->
                <div class="analysis-section">
                    <div class="section-title">
                        âš–ï¸ ç†æ€§ä¸æƒ…ç»ªåˆ†æ
                    </div>
                    <div class="rational-emotional-split">
                        ${renderRationalAnalysis(outlook.rational)}
                        ${renderEmotionalAnalysis(outlook.emotional)}
                    </div>
                </div>

                <!-- è¶‹åŠ¿é¢„æµ‹ -->
                <div class="analysis-section">
                    <div class="section-title">
                        ğŸ“ˆ è¶‹åŠ¿é¢„æµ‹
                    </div>
                    <div class="prediction-section">
                        ${renderPrediction(outlook.predictions.one_day, '1å¤©', 'æ˜å¤©')}
                        ${renderPrediction(outlook.predictions.three_days, '3å¤©', 'æœªæ¥ä¸‰å¤©')}
                        ${renderPrediction(outlook.predictions.one_week, '1å‘¨', 'æœªæ¥ä¸€å‘¨')}
                    </div>
                </div>

                <!-- ç»¼åˆå»ºè®® -->
                <div class="analysis-section">
                    <div class="section-title">
                        ğŸ¯ ç»¼åˆæ“ä½œå»ºè®®
                    </div>
                    <div style="padding: 20px; background: rgba(0,212,255,0.1); border-radius: 15px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 15px; color: ${getTrendColor(outlook.predictions.one_week.trend)};">
                            ${getTrendIcon(outlook.predictions.one_week.trend)} ${outlook.predictions.one_week.trend === 'up' ? 'çœ‹æ¶¨' : outlook.predictions.one_week.trend === 'down' ? 'çœ‹è·Œ' : 'ä¸­æ€§'}
                        </div>
                        <div style="color: #aaa; margin-bottom: 10px;">
                            åŸºäºå®è§‚ç¯å¢ƒ ${outlook.rational.score}/100 + å¸‚åœºæƒ…ç»ª ${outlook.emotional.score}/100
                        </div>
                        <div style="font-size: 14px; color: #888; max-width: 600px; margin: 0 auto;">
                            ${outlook.recommendation || 'å»ºè®®å…³æ³¨å¸‚åœºåŠ¨æ€ï¼Œæ ¹æ®å®é™…èµ°åŠ¿è°ƒæ•´ç­–ç•¥'}
                        </div>
                    </div>
                </div>

                <!-- æ›´æ–°æ—¶é—´ -->
                <div style="text-align: center; color: #666; font-size: 12px; margin-top: 20px;">
                    åˆ†ææ—¶é—´: ${new Date().toLocaleString('zh-CN')}
                </div>
            `;
        }

        function renderMacroFactors(macro) {
            const factors = [
                { label: 'åˆ©ç‡ç¯å¢ƒ', value: macro.interest_rate || 'ä¸­æ€§', impact: macro.interest_rate_impact || 'neutral' },
                { label: 'é€šèƒ€æ°´å¹³', value: macro.inflation || 'ç¨³å®š', impact: macro.inflation_impact || 'neutral' },
                { label: 'GDPå¢é•¿', value: macro.gdp || 'æ­£å¸¸', impact: macro.gdp_impact || 'neutral' },
                { label: 'å¤±ä¸šç‡', value: macro.unemployment || 'ç¨³å®š', impact: macro.unemployment_impact || 'neutral' },
                { label: 'æ”¿ç­–ç¯å¢ƒ', value: macro.policy || 'ä¸­æ€§', impact: macro.policy_impact || 'neutral' },
                { label: 'åœ°ç¼˜æ”¿æ²»', value: macro.geopolitical || 'ç¨³å®š', impact: macro.geopolitical_impact || 'neutral' },
            ];

            return factors.map(f => `
                <div class="factor-card">
                    <div class="label">${f.label}</div>
                    <div class="value">${f.value}</div>
                    <div class="impact ${f.impact}">${getImpactText(f.impact)}</div>
                </div>
            `).join('');
        }

        function renderSentimentFactors(sentiment) {
            const factors = [
                { label: 'VIXææ…ŒæŒ‡æ•°', value: sentiment.vix || 'æ­£å¸¸', impact: sentiment.vix_impact || 'neutral' },
                { label: 'Put/Callæ¯”ç‡', value: sentiment.put_call_ratio || '1.0', impact: sentiment.put_call_impact || 'neutral' },
                { label: 'èµ„é‡‘æµå‘', value: sentiment.flow || 'ä¸­æ€§', impact: sentiment.flow_impact || 'neutral' },
                { label: 'å¸‚åœºå¹¿åº¦', value: sentiment.breadth || 'æ­£å¸¸', impact: sentiment.breadth_impact || 'neutral' },
            ];

            return factors.map(f => `
                <div class="factor-card">
                    <div class="label">${f.label}</div>
                    <div class="value">${f.value}</div>
                    <div class="impact ${f.impact}">${getImpactText(f.impact)}</div>
                </div>
            `).join('');
        }

        function renderRationalAnalysis(rational) {
            const factors = rational.factors || [];
            return `
                <div class="split-card">
                    <div class="header">
                        <span class="icon">ğŸ§ </span>
                        <span class="title">ç†æ€§åˆ†æ (åŸºæœ¬é¢)</span>
                        <span style="margin-left: auto; color: ${getScoreColor(rational.score)}; font-weight: bold;">
                            ${rational.score || 50}/100
                        </span>
                    </div>
                    ${factors.map(f => `
                        <div class="score">
                            <span class="label">${f.name}</span>
                            <span class="value">${f.value}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderEmotionalAnalysis(emotional) {
            const factors = emotional.factors || [];
            return `
                <div class="split-card">
                    <div class="header">
                        <span class="icon">ğŸ’­</span>
                        <span class="title">æƒ…ç»ªåˆ†æ (å¸‚åœºå¿ƒç†)</span>
                        <span style="margin-left: auto; color: ${getScoreColor(emotional.score)}; font-weight: bold;">
                            ${emotional.score || 50}/100
                        </span>
                    </div>
                    ${factors.map(f => `
                        <div class="score">
                            <span class="label">${f.name}</span>
                            <span class="value">${f.value}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderPrediction(pred, timeframe, label) {
            const trendClass = pred.trend || 'neutral';
            const trendText = pred.trend === 'up' ? 'çœ‹æ¶¨ ğŸ“ˆ' : pred.trend === 'down' ? 'çœ‹è·Œ ğŸ“‰' : 'ä¸­æ€§ â¡ï¸';

            return `
                <div class="prediction-card">
                    <div class="timeframe">${label}</div>
                    <div class="trend ${trendClass}">${trendText}</div>
                    <div class="confidence">ä¿¡å¿ƒ: ${pred.confidence || 'ä¸­ç­‰'}</div>
                    <div class="factors">
                        <div style="margin-bottom: 10px;"><strong>å…³é”®å› ç´ :</strong></div>
                        ${(pred.factors || []).map(f => `<div>â€¢ ${f}</div>`).join('')}
                    </div>
                </div>
            `;
        }

        function getImpactText(impact) {
            const map = {
                'positive': 'åˆ©å¥½',
                'negative': 'åˆ©ç©º',
                'neutral': 'ä¸­æ€§'
            };
            return map[impact] || 'ä¸­æ€§';
        }

        function getTrendColor(trend) {
            if (trend === 'up') return '#00c853';
            if (trend === 'down') return '#ff5252';
            return '#888';
        }

        function getTrendIcon(trend) {
            if (trend === 'up') return 'ğŸ“ˆ';
            if (trend === 'down') return 'ğŸ“‰';
            return 'â¡ï¸';
        }

        function getScoreColor(score) {
            if (score >= 60) return '#00c853';
            if (score >= 40) return '#ffc107';
            return '#ff5252';
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        loadMarketOutlook();
    </script>
</body>
</html>
