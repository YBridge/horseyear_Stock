<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ ç­–ç•¥å†å² - ç¾è‚¡AIåˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            min-height: 100vh;
            color: #e4e6eb;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav a {
            color: #888;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .nav a:hover, .nav a.active {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }

        .nav a.active {
            background: rgba(0, 212, 255, 0.2);
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            background: transparent;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .strategies-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .strategy-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: center;
            transition: all 0.3s;
        }

        .strategy-card:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(5px);
        }

        .strategy-card .symbol-box {
            text-align: center;
        }

        .strategy-card .symbol-box .symbol {
            font-size: 20px;
            font-weight: bold;
        }

        .strategy-card .symbol-box .date {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
        }

        .strategy-card .action-box {
            text-align: center;
        }

        .strategy-card .action-box .action {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .strategy-card .action-box .score {
            font-size: 12px;
            color: #888;
        }

        .strategy-card .price-box .label {
            font-size: 11px;
            color: #888;
        }

        .strategy-card .price-box .entry {
            font-size: 16px;
            font-weight: bold;
            color: #00d4ff;
        }

        .strategy-card .price-box .targets {
            font-size: 12px;
            color: #00c853;
        }

        .strategy-card .notes-box .position {
            font-size: 13px;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .strategy-card .notes-box .risk {
            font-size: 11px;
            color: #888;
        }

        .strategy-card .delete-btn {
            padding: 8px 12px;
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid rgba(255, 82, 82, 0.5);
            border-radius: 8px;
            color: #ff5252;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .strategy-card .delete-btn:hover {
            background: rgba(255, 82, 82, 0.4);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .by-symbol-section {
            margin-bottom: 30px;
        }

        .by-symbol-section .title {
            font-size: 18px;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-card .label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .strategy-card {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ç­–ç•¥å†å²</h1>
            <p style="color: #888;">è·Ÿè¸ªæ‚¨çš„æŠ•èµ„å†³ç­–å’Œç­–ç•¥è®°å½•</p>
        </div>

        <nav class="nav">
            <a href="/">ğŸ“Š è‚¡ç¥¨åˆ†æ</a>
            <a href="/watchlist">ğŸ¯ å…³æ³¨åˆ—è¡¨</a>
            <a href="/strategies" class="active">ğŸ“ ç­–ç•¥å†å²</a>
            <a href="/ai_stocks">ğŸ¤– AIæŠ•èµ„</a>
            <a href="/market_outlook">ğŸŒ å¸‚åœºå‰ç»</a>
        </nav>

        <div class="filters">
            <button class="filter-btn active" onclick="filterStrategies('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="filterStrategies('buy')">ä¹°å…¥ç±»</button>
            <button class="filter-btn" onclick="filterStrategies('hold')">æŒæœ‰ç±»</button>
            <button class="filter-btn" onclick="filterStrategies('sell')">è§‚æœ›/è§„é¿</button>
        </div>

        <div class="stats" id="stats"></div>

        <div id="strategiesContainer"></div>
    </div>

    <script>
        let allStrategies = [];
        let currentFilter = 'all';

        async function loadStrategies() {
            const response = await fetch('/get_strategies');
            const data = await response.json();
            allStrategies = data.strategies || [];
            renderStrategies();
            renderStats();
        }

        function filterStrategies(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderStrategies();
        }

        function renderStrategies() {
            const container = document.getElementById('strategiesContainer');

            let filtered = allStrategies;
            if (currentFilter === 'buy') {
                filtered = allStrategies.filter(s => s.action.includes('ä¹°å…¥'));
            } else if (currentFilter === 'hold') {
                filtered = allStrategies.filter(s => s.action === 'æŒæœ‰');
            } else if (currentFilter === 'sell') {
                filtered = allStrategies.filter(s => s.action.includes('è§‚æœ›') || s.action.includes('è§„é¿'));
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>æš‚æ— ç­–ç•¥è®°å½•</p>
                        <p style="font-size: 13px; margin-top: 10px;">åœ¨å…³æ³¨åˆ—è¡¨é¡µé¢åˆ†æè‚¡ç¥¨åï¼Œç‚¹å‡»"ä¿å­˜ä¸ºç­–ç•¥"å³å¯åœ¨æ­¤å¤„æŸ¥çœ‹</p>
                    </div>
                `;
                return;
            }

            // æŒ‰ç¬¦å·åˆ†ç»„
            const bySymbol = {};
            filtered.forEach(s => {
                if (!bySymbol[s.symbol]) bySymbol[s.symbol] = [];
                bySymbol[s.symbol].push(s);
            });

            let html = '';
            for (const [symbol, strategies] of Object.entries(bySymbol)) {
                html += `
                <div class="by-symbol-section">
                    <div class="title">${symbol} Â· ${strategies.length} æ¡è®°å½•</div>
                    <div class="strategies-list">
                        ${strategies.map(s => renderStrategyCard(s)).join('')}
                    </div>
                </div>
                `;
            }

            container.innerHTML = html;
        }

        function renderStrategyCard(s) {
            const changeClass = s.current_price > 0 ? 'positive' : 'neutral';

            return `
            <div class="strategy-card" data-id="${s.id}">
                <div class="symbol-box">
                    <div class="symbol">${s.symbol}</div>
                    <div class="date">${s.created_at}</div>
                </div>

                <div class="action-box">
                    <div class="action" style="background: ${s.action_color}">${s.action}</div>
                    <div class="score">è¯„åˆ†: ${s.total_score}</div>
                </div>

                <div class="price-box">
                    <div class="label">å…¥åœºä»·</div>
                    <div class="entry">$${s.entry_price?.toFixed(2)}</div>
                    <div class="targets">ç›®æ ‡: $${s.target_short?.toFixed(2)} - $${s.target_long?.toFixed(2)}</div>
                </div>

                <div class="notes-box">
                    <div class="position">${s.position}</div>
                    <div class="risk">æ­¢æŸ: $${s.stop_loss?.toFixed(2)} (${s.risk_pct}% é£é™©)</div>
                </div>

                <div class="delete-btn" onclick="deleteStrategy('${s.id}')">åˆ é™¤</div>
            </div>
            `;
        }

        function renderStats() {
            const container = document.getElementById('stats');

            const total = allStrategies.length;
            const buyStrategies = allStrategies.filter(s => s.action.includes('ä¹°å…¥')).length;
            const symbols = [...new Set(allStrategies.map(s => s.symbol))].length;

            container.innerHTML = `
            <div class="stat-card">
                <div class="value">${total}</div>
                <div class="label">æ€»ç­–ç•¥æ•°</div>
            </div>
            <div class="stat-card">
                <div class="value">${symbols}</div>
                <div class="label">å…³æ³¨è‚¡ç¥¨</div>
            </div>
            <div class="stat-card">
                <div class="value">${buyStrategies}</div>
                <div class="label">ä¹°å…¥å»ºè®®</div>
            </div>
            <div class="stat-card">
                <div class="value">${Math.round(buyStrategies/total*100) || 0}%</div>
                <div class="label">ä¹°å…¥æ¯”ä¾‹</div>
            </div>
            `;
        }

        async function deleteStrategy(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç­–ç•¥å—ï¼Ÿ')) return;

            const response = await fetch('/delete_strategy', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id})
            });

            if (response.ok) {
                allStrategies = allStrategies.filter(s => s.id !== id);
                renderStrategies();
                renderStats();
            }
        }

        // åˆå§‹åŒ–
        loadStrategies();
    </script>
</body>
</html>
